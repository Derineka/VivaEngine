# Github https://github.com/fcwu/docker-ubuntu-vnc-desktop
FROM dorowu/ubuntu-desktop-lxde-vnc:focal

## If connecting via VNC, "pass" is the password
ENV VNC_PASSWORD pass

## If a set resolution is needed for the VM
# ENV RESOLUTION 1600x900

## If the ubuntu user is needed
# RUN adduser --disabled-password --gecos '' ubuntu

## Install Dependencies
RUN apt -y update && \
    apt -y upgrade && \
    apt -y install openssh-server llvm clang lldb make wget python3 ninja-build git libsdl2-dev unzip

## Install CMAKE
RUN wget -q -O cmake-linux.sh https://github.com/Kitware/CMake/releases/download/v3.21.3/cmake-3.21.3-Linux-x86_64.sh
RUN sh cmake-linux.sh -- --skip-license --prefix=/usr/
RUN rm cmake-linux.sh

## Install liburing
RUN wget http://mirrors.kernel.org/ubuntu/pool/main/libu/liburing/liburing-dev_0.7-3ubuntu3_amd64.deb
RUN wget http://mirrors.kernel.org/ubuntu/pool/main/libu/liburing/liburing1_0.7-3ubuntu3_amd64.deb
RUN dpkg -i liburing*deb
RUN rm liburing*deb

## If the ubuntu user needs to run commands
#RUN apt -y install sudo

## Set a password to root for SSH
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN echo 'root:pass' | chpasswd

## If the ubuntu user is needed
# RUN echo 'ubuntu:pass' | chpasswd

RUN service ssh start
## This adds a ssh restart to the entry point of this image. If this is not performed,
## the ssh service does not allow root/ubuntu to connect
RUN sed -i '2 i service ssh restart' /startup.sh

## SSH Port
EXPOSE 22
